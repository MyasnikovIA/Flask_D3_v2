# Mask

Компонент для добавления маски к полю

## Параметры

* controls - список контролов, на которые навешивается маска.

Пример:

```xml
<cmpMask controls="HOUSE;BUILDING_IDENT"/>
```

У компонента, на который навешивается маска можно прописать следующие параметры:

|*Параметр*|*Описание*|
|---|---|
|mask_type | тип маски. |
|mask_template| шаблон маски 9 - цифра, a - буква, x - цифра или буква|
|mask_original| Символы которыми заменяются недостающие символы в контроле для корректной проверки по шаблону |
|mask_check_regular|регулярное выражение для проверки введенного значения с шаблоном|
|mask_check_function|тоже только функция, входной параметр значение которое надо проверить, на выходе true или false|
|mask_template_regular|используется когда невозможно четко определить шаблон. Регулярное выражение для предварительной проверки во время ввода|
|mask_template_function|тоже только функция|
|mask_empty|значение может быть пустым. По умолчанию true|
|mask_strip|при указании данного свойства true и шаблона mask_template при потере фокуса не заменяет символы подчеркивания на символы из mask_original|
|mask_char_replace|указывается строка состоящая из пар символов. Заменяет вводимый с клавиатуры символ (первый в любой паре) на соответвующий ему второй символ из пары. Наример: ",.ёе" будет заменять при вводе все запятые на точки и буквы 'ё' на буквы 'е'|
|mask_clear|если указано true то из конечного значения будут удалены все символы которые совпали с шаблоном и оригиналом, но в контроле они будут отображатся (например дефисы из СНИЛС)|

Если указан **mask_type** то другие указание параметров **mask_template** и **mask_check** не имеет смысла поскольку они предопределены для указанных типов.
Допустимые предопределенные типы:
* time (время)
* date (дата)
* number (число)
* fnumber (число с плавающей запятой)
* alpha (текст)
* alphanumber (текст с числами)
* numberlen (функция: число, регулируется количество цифр )
* fnumberlen (функция: число с плавающей запятой, регулируется максимальное количество цифр перед и после запятой)

При указании **mask_template** допускается указание дополнительной проверки по регулятному выражению (**mask_check_regular**) или по функции (**mask_check_function**).

## Логика работы компонента

 При нажатия на клавиши делается проверка на удовлетворение шаблону (**mask_template**) затем по регулярному выражению (**mask_template_regular**) и в последнюю очередь по функции (**mask_template_function**), если символ не удовлетворяет то он подавляется и не выводится в контрол.
 
 При потере фокуса ввода контролом (или при событии onChange) делается проверка по регулярному выражению (если указан параметр **mask_check_regular**), а затем делается проверка по функции (если указан параметр **mask_check_function**). В случае если проверка строки завершилась неудачей то контрол получает статус **error** (свойство error становится равным true) и делается соответсвующая подсветка.

Функции для проверок должны принимать на вход проверяемое значение и возвращать true в случае успешной проверки.

## Скрипты

 Для того, чтобы добавить динамически объекту какой-то параметр маски используется функция
 
```js
D3Api.MaskCtrl.setParam (control, parametr, value)
```
Например,

```js
D3Api.MaskCtrl.setParam(getControl('ValueClone'), 'mask_type', 'date');
```
